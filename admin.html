<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin GitHub - Tilo Café</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 20px;
      background: #fffafa;
      color: #68310f;
    }
    form, .preview, .json-output {
      max-width: 600px;
      margin: 0 auto 30px auto;
      padding: 10px;
    }
    input, select, button, textarea {
      padding: 10px;
      margin: 6px 0;
      width: 100%;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    button {
      background-color: #68310f;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #4c2812;
    }
    .preview {
      background: #cccccc;
      border-radius: 10px;
      padding: 10px;
    }
    .preview img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .json-output {
      background: #f4f4f4;
      border: 1px solid #ccc;
      font-family: monospace;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

<h1>Admin Tilo Café (conexión directa a GitHub)</h1>

<form id="productForm">
  <input type="text" id="nombre" placeholder="Nombre del producto" required />
  <textarea id="descripcion" placeholder="Descripción" required></textarea>
  <input type="text" id="precio" placeholder="Precio (ej: $2500)" required />
  <input type="text" id="imagen" placeholder="img/archivo.jpg" required />
  <select id="categoria" required>
    <option value="">Categoría</option>
    <option>Cafetería</option>
    <option>Desayunos y Meriendas</option>
    <option>Pastelería</option>
    <option>Sandwiches</option>
    <option>Tartas</option>
    <option>Burritos</option>
    <option>Refrescos</option>
    <option>Lomitos o Burgers</option>
    <option>Omelet / Tortillas</option>
    <option>Ensaladas</option>
    <option>Milanesas</option>
    <option>Menú Kids</option>
    <option>Especialidades</option>
    <option>Entradas</option>
    <option>Pizza</option>
    <option>Risottos</option>
    <option>Pastas</option>
    <option>Salsas</option>
    <option>Grill</option>
    <option>Postres</option>
    <option>Menú del Día</option>
    <option>Sugerencias del Día</option>
    <option>Vinos</option>
    <option>Tragos</option>
  </select>
  <input type="password" id="token" placeholder="Token GitHub (secreto)" required />
  <button type="submit">Agregar producto</button>
</form>

<div class="preview" id="preview" style="display: none;">
  <img id="preview-img" src="" alt="">
  <h3 id="preview-nombre"></h3>
  <p id="preview-descripcion"></p>
  <p id="preview-precio"></p>
</div>

<button onclick="guardarEnGitHub()">Guardar en GitHub</button>

<div class="json-output" id="jsonOutput"></div>

<script>
let productos = [];

document.getElementById('productForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const nuevo = {
    nombre: nombre.value,
    descripcion: descripcion.value,
    precio: precio.value,
    imagen: imagen.value,
    categoria: categoria.value
  };
  productos.push(nuevo);
  document.getElementById("preview").style.display = "block";
  document.getElementById("preview-img").src = nuevo.imagen;
  document.getElementById("preview-nombre").innerText = nuevo.nombre;
  document.getElementById("preview-descripcion").innerText = nuevo.descripcion;
  document.getElementById("preview-precio").innerText = nuevo.precio;
  document.getElementById("productForm").reset();
});

async function guardarEnGitHub() {
  const token = document.getElementById("token").value.trim();
  if (!token) return alert("Pegá tu token de GitHub para guardar.");

  const owner = "cholose10";
  const repo = "Carta";
  const path = "productos.json";
  const branch = "main";

  const jsonContent = JSON.stringify(productos, null, 2);
  const base64Content = btoa(unescape(encodeURIComponent(jsonContent)));

  // Obtener el SHA actual del archivo
  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
  const res = await fetch(url, {
    headers: {
      Authorization: `token ${token}`
    }
  });
  const data = await res.json();
  const sha = data.sha;

  // Subir archivo actualizado
  const subir = await fetch(url, {
    method: "PUT",
    headers: {
      Authorization: `token ${token}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message: "Actualización automática desde admin.html",
      content: base64Content,
      sha: sha,
      branch: branch
    })
  });

  if (subir.ok) {
    alert("✅ El archivo productos.json fue guardado en GitHub.");
    document.getElementById("jsonOutput").innerText = jsonContent;
  } else {
    alert("❌ Error al subir el archivo. Verificá tu token y que el archivo exista.");
  }
}
</script>

</body>
</html>
